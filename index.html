<!DOCTYPE html>
<html lang="fr">
<head>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Institut Coran - Version Complète</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🕌 Institut de Coran</h1>
            <p>Système de gestion complet</p>
        </div>

        <div class="mobile-nav">
            <button class="nav-button active" onclick="switchToSection('dashboard', this)">
                <span>📊 Tableau de bord</span>
            </button>
            <button class="nav-button" onclick="switchToSection('students', this)">
                <span>👥 Élèves</span>
            </button>
            <button class="nav-button" onclick="switchToSection('teachers', this)">
                <span>👨‍🏫 Professeurs</span>
            </button>
            <button class="nav-button" onclick="switchToSection('products', this)">
                <span>📦 Produits</span>
            </button>
            <button class="nav-button" onclick="switchToSection('payments', this)">
                <span>💰 Paiements</span>
            </button>
            <button class="nav-button" onclick="switchToSection('accounting', this)">
                <span>📊 Comptabilité</span>
            </button>
        </div>

        <!-- SECTION COMPTABILITÉ -->
        <div id="accounting" class="section-content">
            <div class="form-section">
                <h3>📊 Comptabilité mensuelle</h3>

                <div style="display: flex; gap: 10px; margin-bottom: 20px; align-items: center;">
                    <label><strong>Mois :</strong></label>
                    <select id="monthSelector" onchange="changeMonth()">
                        <option value="0">Janvier</option>
                        <option value="1">Février</option>
                        <option value="2">Mars</option>
                        <option value="3">Avril</option>
                        <option value="4">Mai</option>
                        <option value="5">Juin</option>
                        <option value="6">Juillet</option>
                        <option value="7">Août</option>
                        <option value="8">Septembre</option>
                        <option value="9">Octobre</option>
                        <option value="10">Novembre</option>
                        <option value="11">Décembre</option>
                    </select>

                    <label><strong>Année :</strong></label>
                    <select id="yearSelector" onchange="changeMonth()">
                        <option value="2024">2024</option>
                        <option value="2025">2025</option>
                        <option value="2026">2026</option>
                    </select>
                </div>

                <div class="financial-summary">
                    <h4 style="margin-bottom: 15px; color: #2c3e50;">💰 Résumé du mois sélectionné</h4>
                    <div class="financial-grid">
                        <div class="financial-item">
                            <strong>📈 Entrées totales</strong><br>
                            <span id="totalIncome" style="color: #28a745; font-weight: bold;">0€</span>
                        </div>
                        <div class="financial-item">
                            <strong>📉 Sorties totales</strong><br>
                            <span id="totalExpenses" style="color: #dc3545; font-weight: bold;">0€</span>
                        </div>
                        <div class="financial-item">
                            <strong>👨‍🏫 Salaires profs</strong><br>
                            <span id="totalTeacherSalaries" style="color: #dc3545; font-weight: bold;">0€</span>
                        </div>
                        <div class="financial-item">
                            <strong>💎 Bénéfice net</strong><br>
                            <span id="netProfit" style="color: #007bff; font-weight: bold;">0€</span>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>➕ Ajouter une sortie d'argent</h3>
                    <form id="expenseForm">
                        <div class="form-group">
                            <label>Description *</label>
                            <input type="text" id="expenseDescription" required placeholder="Ex: Loyer, électricité, matériel...">
                        </div>

                        <div class="form-group">
                            <label>Montant (€) *</label>
                            <input type="number" id="expenseAmount" required min="0" step="0.01" placeholder="0.00">
                        </div>

                        <div class="form-group">
                            <label>Date</label>
                            <input type="date" id="expenseDate" required>
                        </div>

                        <button type="submit" class="btn">💸 Ajouter cette sortie</button>
                    </form>
                </div>

                <div class="form-section">
                    <h3>📉 Liste des sorties (<span id="expensesCount">0</span>)</h3>
                    <div id="expensesListContainer" class="simple-table">
                        <div class="empty-state">Aucune sortie enregistrée</div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>💾 Synchronisation temps réel</h3>
                    <div style="text-align: center; padding: 20px; background: #e8f5e8; border-radius: 10px;">
                        <p><strong>🔄 Statut :</strong> <span id="syncStatus" style="color: #28a745;">Synchronisé</span></p>
                        <p><strong>👥 Collaboration :</strong> Toutes vos modifications sont automatiquement partagées avec votre collègue</p>
                        <button class="btn btn-success" onclick="forceSyncNow()" style="width: auto; margin: 10px;">🔄 Synchroniser maintenant</button>
                        <button class="btn btn-success" onclick="downloadMonthlyBackup()" style="width: auto; margin: 10px;">📥 Télécharger sauvegarde du mois</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- TABLEAU DE BORD -->
        <div id="dashboard" class="section-content active">
            <div class="stats-grid">
                <div class="stat-card">
                    <h3 id="totalStudents">0</h3>
                    <p>Élèves inscrits</p>
                </div>
                <div class="stat-card">
                    <h3 id="totalTeachers">0</h3>
                    <p>Professeurs</p>
                </div>
                <div class="stat-card">
                    <h3 id="monthlyRevenue">0€</h3>
                    <p>Revenus du mois</p>
                </div>
                <div class="stat-card">
                    <h3 id="pendingPayments">0€</h3>
                    <p>En attente</p>
                </div>
            </div>

            <div class="form-section">
                <h3>📊 Fonctionnalités disponibles</h3>
                <ul style="margin-top: 10px; padding-left: 20px;">
                    <li>✅ Gestion des élèves avec calcul prorata</li>
                    <li>✅ Système de réductions personnalisées</li>
                    <li>✅ Frais d'inscription automatiques (nouveaux élèves)</li>
                    <li>✅ Gestion des professeurs</li>
                    <li>✅ Vente de produits (livres, matériel...)</li>
                    <li>✅ Suivi des paiements en temps réel</li>
                    <li>✅ Sauvegarde automatique des données</li>
                </ul>
            </div>
        </div>

        <!-- SECTION ELEVES -->
        <div id="students" class="section-content">
            <div class="form-section">
                <h3>➕ Ajouter un nouvel élève</h3>
                <form id="studentForm">
                    <div class="form-group">
                        <label>Prénom de l'élève *</label>
                        <input type="text" id="studentFirstName" required placeholder="Ex: Ahmed">
                    </div>

                    <div class="form-group">
                        <label>Nom de l'élève *</label>
                        <input type="text" id="studentLastName" required placeholder="Ex: Benali">
                    </div>

                    <div class="form-group">
                        <label>Numéro de téléphone</label>
                        <input type="tel" id="studentPhone" placeholder="Ex: +33 6 12 34 56 78">
                    </div>

                    <div class="form-group">
                        <label>Type de formule *</label>
                        <select id="studentFormula" required>
                            <option value="">-- Sélectionnez une formule --</option>
                            <option value="groupe_2h">👥 Cours en groupe - 2h par semaine (32€/mois)</option>
                            <option value="groupe_1h">👥 Cours en groupe - 1h par semaine (16€/mois)</option>
                            <option value="duo">👫 Cours en duo (7€ par heure et par élève)</option>
                            <option value="individuel">👤 Cours individuel (10€ par heure)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Nombre d'heures par semaine</label>
                        <select id="studentHours">
                            <option value="0.5">30 minutes</option>
                            <option value="1">1 heure</option>
                            <option value="1.5">1h30</option>
                            <option value="2">2 heures</option>
                            <option value="3">3 heures</option>
                            <option value="4">4 heures</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>💸 Réduction (en €)</label>
                        <input type="number" id="studentReduction" min="0" step="0.01" placeholder="0" value="0">
                        <div class="small-text">Montant à déduire du prix mensuel</div>
                    </div>

                    <div class="form-group">
                        <label>👤 Type d'inscription</label>
                        <select id="inscriptionType">
                            <option value="new">🆕 Nouveau élève (+5€ frais d'inscription)</option>
                            <option value="renewal">🔄 Renouvellement (pas de frais)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Jours de cours dans la semaine *</label>
                        <div class="course-days-container">
                            <div class="small-text" style="margin-bottom: 15px;">Cliquez sur les jours de cours :</div>
                            <div class="course-days-grid">
                                <label class="day-checkbox" onclick="toggleDaySelection(this)">
                                    <input type="checkbox" value="1">
                                    Lundi
                                </label>
                                <label class="day-checkbox" onclick="toggleDaySelection(this)">
                                    <input type="checkbox" value="2">
                                    Mardi
                                </label>
                                <label class="day-checkbox" onclick="toggleDaySelection(this)">
                                    <input type="checkbox" value="3">
                                    Mercredi
                                </label>
                                <label class="day-checkbox" onclick="toggleDaySelection(this)">
                                    <input type="checkbox" value="4">
                                    Jeudi
                                </label>
                                <label class="day-checkbox" onclick="toggleDaySelection(this)">
                                    <input type="checkbox" value="5">
                                    Vendredi
                                </label>
                                <label class="day-checkbox" onclick="toggleDaySelection(this)">
                                    <input type="checkbox" value="6">
                                    Samedi
                                </label>
                                <label class="day-checkbox" onclick="toggleDaySelection(this)">
                                    <input type="checkbox" value="0">
                                    Dimanche
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Date d'inscription *</label>
                        <input type="date" id="registrationDate" required>
                    </div>

                    <div class="form-group">
                        <label>Professeur assigné</label>
                        <select id="assignedTeacher">
                            <option value="">-- Sélectionnez un professeur --</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>💰 Prix mensuel final</label>
                        <input type="text" id="fullMonthlyPrice" readonly class="price-field">
                    </div>

                    <div class="form-group">
                        <label>📅 Prix au prorata (premier mois)</label>
                        <input type="text" id="prorataPrice" readonly class="prorata-field">
                    </div>

                    <div class="form-group">
                        <label>📋 Détail du calcul</label>
                        <input type="text" id="calculationDetails" readonly>
                    </div>

                    <button type="submit" class="btn">✅ Ajouter cet élève</button>
                </form>
            </div>

            <div class="form-section">
                <h3>📋 Liste des élèves (<span id="studentsCount">0</span>)</h3>
                <div id="studentsListContainer" class="simple-table">
                    <div class="empty-state">
                        Aucun élève inscrit pour le moment<br>
                        <small>Utilisez le formulaire ci-dessus pour ajouter votre premier élève</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- SECTION PROFESSEURS -->
        <div id="teachers" class="section-content">
            <div class="form-section">
                <h3>➕ Ajouter un nouveau professeur</h3>
                <form id="teacherForm">
                    <div class="form-group">
                        <label>Prénom du professeur *</label>
                        <input type="text" id="teacherFirstName" required placeholder="Ex: Fatima">
                    </div>

                    <div class="form-group">
                        <label>Nom du professeur *</label>
                        <input type="text" id="teacherLastName" required placeholder="Ex: El-Mansouri">
                    </div>

                    <div class="form-group">
                        <label>Spécialité d'enseignement</label>
                        <select id="teacherSpecialty">
                            <option value="Coran et Tajwid">📖 Coran et Tajwid</option>
                            <option value="Coran">📜 Coran uniquement</option>
                            <option value="Tajwid">🎵 Tajwid uniquement</option>
                            <option value="Arabe">🔤 Langue arabe</option>
                            <option value="Islamique">🕌 Sciences islamiques</option>
                        </select>
                    </div>

                    <button type="submit" class="btn">✅ Ajouter ce professeur</button>
                </form>
            </div>

            <div class="form-section">
                <h3>👨‍🏫 Liste des professeurs (<span id="teachersCount">0</span>)</h3>
                <div id="teachersListContainer" class="simple-table">
                    <div class="empty-state">
                        Aucun professeur ajouté pour le moment<br>
                        <small>Utilisez le formulaire ci-dessus pour ajouter votre premier professeur</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- SECTION PRODUITS -->
        <div id="products" class="section-content">
            <div class="form-section">
                <h3>➕ Ajouter un nouveau produit</h3>
                <form id="productForm">
                    <div class="form-group">
                        <label>Nom du produit *</label>
                        <input type="text" id="productName" required placeholder="Ex: Livre de Tajwid">
                    </div>

                    <div class="form-group">
                        <label>Prix (en €) *</label>
                        <input type="number" id="productPrice" required min="0" step="0.01" placeholder="15.00">
                    </div>

                    <div class="form-group">
                        <label>Description</label>
                        <input type="text" id="productDescription" placeholder="Description optionnelle">
                    </div>

                    <button type="submit" class="btn">✅ Ajouter ce produit</button>
                </form>
            </div>

            <div class="form-section">
                <h3>🛒 Vendre un produit à un élève</h3>
                <form id="saleForm">
                    <div class="form-group">
                        <label>Élève *</label>
                        <select id="saleStudentSelect" required>
                            <option value="">-- Sélectionnez un élève --</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Produit *</label>
                        <select id="saleProductSelect" required>
                            <option value="">-- Sélectionnez un produit --</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Quantité</label>
                        <input type="number" id="saleQuantity" min="1" value="1" required>
                    </div>

                    <div class="form-group">
                        <label>💰 Total</label>
                        <input type="text" id="saleTotal" readonly class="price-field">
                    </div>

                    <button type="submit" class="btn">🛒 Enregistrer la vente</button>
                </form>
            </div>

            <div class="form-section">
                <h3>📦 Liste des produits (<span id="productsCount">0</span>)</h3>
                <div id="productsListContainer" class="simple-table">
                    <div class="empty-state">
                        Aucun produit ajouté<br>
                        <small>Ajoutez vos premiers produits ci-dessus</small>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h3>🛒 Historique des ventes (<span id="salesCount">0</span>)</h3>
                <div id="salesListContainer" class="simple-table">
                    <div class="empty-state">
                        Aucune vente enregistrée<br>
                        <small>Les ventes apparaîtront ici</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- SECTION PAIEMENTS -->
        <div id="payments" class="section-content">
            <div class="form-section">
                <h3>💰 Suivi des paiements - <span id="currentMonthDisplay"></span></h3>

                <div class="financial-summary">
                    <h4 style="margin-bottom: 15px; color: #2c3e50;">📊 Résumé financier du mois</h4>
                    <div class="financial-grid">
                        <div class="financial-item">
                            <strong>Total attendu</strong><br>
                            <span id="totalExpectedAmount" style="color: #28a745; font-weight: bold;">0€</span>
                        </div>
                        <div class="financial-item">
                            <strong>Total reçu</strong><br>
                            <span id="totalReceivedAmount" style="color: #28a745; font-weight: bold;">0€</span>
                        </div>
                        <div class="financial-item">
                            <strong>En attente</strong><br>
                            <span id="totalPendingAmount" style="color: #dc3545; font-weight: bold;">0€</span>
                        </div>
                        <div class="financial-item">
                            <strong>Frais d'inscription</strong><br>
                            <span id="totalInscriptionAmount" style="color: #28a745; font-weight: bold;">0€</span>
                        </div>
                    </div>
                </div>

                <div id="paymentsListContainer" class="simple-table">
                    <div class="empty-state">
                        Aucun paiement à afficher<br>
                        <small>Les paiements apparaîtront quand vous ajouterez des élèves</small>
                    </div>
                </div>
            </div>
        </div>

        <div class="status-bar">
            <h3>✅ Application fonctionnelle</h3>
            <p>Toutes les fonctionnalités sont opérationnelles</p>
        </div>
    </div>
<script src="script.js"></script>
</body>
</html>